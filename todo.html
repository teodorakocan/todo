<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>VanillaJS &#8226; TodoMVC</title>
</head>
<body style="background-color:rgb(234, 238, 238)">
    <div class="grid-container">
        <div class="header">
            <h1>todos</h1>
            <input calss= "addTask" type="text" id="addTask" placeholder="What needs to be done?"><br/><br/>
            <div id="tasks">

            </div><br/><br/>

            <div class="flex-container">
                <div id="numb"></div>
                <div> 
                <button type="button" class="btn active" id="all" onclick="AllTasks()">All</button>
                <button type="button" class="btn" id="active" onclick="ActiveTasks()">Active</button>
                <button type="button"class="btn" id="complited" onclick="ComplitedTasks()">Complited</button></div>
            </div>
        </div>
    </div>

    <script>
        var activeTasks, complitedTasks, allTasks;
        var numOfActiveTasks = 0;
        var numbOfComplited = 0;
        if(localStorage.getItem("tasks") == null || localStorage.getItem("tasks") == ""){
            activeTasks = [];
            complitedTasks = [];
            allTasks = [];
            localStorage.setItem("tasks", allTasks);
            localStorage.setItem("active", activeTasks);
        }
        else if(localStorage.getItem("tasks") != ""){
            activeTasks = localStorage.getItem("active").split(',');
            allTasks = localStorage.getItem("tasks").split(',');
            if(localStorage.getItem("complited") == null)
            {
                complitedTasks = [];
                localStorage.setItem("complited", complitedTasks);
            }
            else{
                complitedTasks = localStorage.getItem("complited").split(',');
            }
            if(activeTasks[0] != ""){
                numOfActiveTasks = activeTasks.length;
            }
            else{
                numOfActiveTasks = 0;
            }

            for(let i = 0; i< allTasks.length; i++)
            {
                addTask(allTasks[i]);
            }
        }

        var numb = document.createElement('label');
        numb.setAttribute("id", "numbOfActive")
        numb.innerText = numOfActiveTasks + " items left";
        document.querySelector("#numb").appendChild(numb);

        var input = document.getElementById('addTask');
        input.addEventListener("keyup", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                if(input.value != '')
                {
                    addTask(input.value);
                    activeTasks.push(input.value);
                    allTasks.push(input.value);
                    localStorage.setItem("tasks", allTasks);
                    localStorage.setItem("active", activeTasks);
                    location.reload();
                }
            }
        });

        function addTask(value){
            var newTask = document.createElement('div');
            newTask.setAttribute("id", "div_"+ value);
            newTask.style.backgroundColor="white";
            newTask.classList.add("jumbotron");
            newTask.classList.add("task");
            document.querySelector("#tasks").appendChild(newTask);
            
            var input = document.createElement('input');
            input.setAttribute("type", "checkbox");
            input.setAttribute("id", "input_"+ value);
            input.style.float = "left";
            input.onchange = function(){
                CrossTask(value);
            };
            document.querySelector("#div_"+value).appendChild(input);

            var task = document.createElement('label');
            task.innerText = value;
            task.setAttribute("id", value);
            task.style.float = "left";
            document.querySelector("#div_"+value).appendChild(task);

            var deletebtn = document.createElement('button');
            deletebtn.innerHTML = '<i class = "fa fa-close"></i>';
            deletebtn.classList.add("btn");
            deletebtn.setAttribute("id", "deletebtn");
            deletebtn.onclick = function(){
                DeleteTask(value);
            };
            deletebtn.style.float = "right";
            deletebtn.style.border= "none";
            deletebtn.style.backgroundColor = "white";
            document.querySelector("#div_"+ value).appendChild(deletebtn);

            if(complitedTasks.length > 0)
            {
                if(complitedTasks.includes(value)){
                    for(let i = 0; i < complitedTasks.length; i++){
                        if(complitedTasks[i] == value)
                        {
                            task.style.textDecoration = "line-through"
                            input.checked = true;
                        }
                    }
                }
            }
        }

        function CheckFilter(){
            var btnAll = document.getElementById("all");
            var btnComplited = document.getElementById("complited");
            var btnActive = document.getElementById("active");

            if(btnAll.classList.contains("active")){
                AllTasks();
            }
            else if(btnComplited.classList.contains("active")){
                ComplitedTasks();
            }
            else if(btnActive.classList.contains("active")){
                ActiveTasks();
            }
        }

        function DeleteTask(value){
            var array = [];
            var active = [];
            var complited = [];
            for(let i = 0; i < allTasks.length; i++){
                if(allTasks[i] != value){
                    array.push(allTasks[i]);
                }
            }

            if(activeTasks.length > 0)
            {
                if(activeTasks.includes(value)){
                    localStorage.removeItem("active");
                    for(let i = 0; i < activeTasks.length; i++){
                        if(activeTasks[i] != value){
                            active.push(activeTasks[i]);
                        }
                    } 
                    localStorage.setItem("active", active);
                }
            }

            if(complitedTasks.length > 0)
            {
                if(complitedTasks.includes(value)){
                    localStorage.removeItem("complited");
                    for(let i = 0; i < complitedTasks.length; i++){
                        if(complitedTasks[i] != value){
                            complited.push(complitedTasks[i]);
                        }
                    }
                    localStorage.setItem("complited", complited);
                }
            }

            localStorage.removeItem("tasks");
            localStorage.setItem("tasks", array);
            location.reload();
        }

        function CrossTask(value){
            var allActive = []; 
            var allComplited = [];

            if(document.getElementById("input_" +value).checked){
                document.getElementById(value).style.textDecoration="line-through";
                if(localStorage.getItem("complited") != "")
                {
                    allComplited = localStorage.getItem("complited").split(',');
                }
                active_array = localStorage.getItem("active").split(',');
                for(let i = 0; i < active_array.length; i++){
                    if(active_array[i] == value)
                    {
                        allComplited.push(active_array[i]);
                    }
                    else{
                        allActive.push(active_array[i]);
                    }
                }

                activeTasks = allActive;
                complitedTasks = allComplited;
                localStorage.setItem('active', allActive);
                localStorage.setItem('complited', allComplited);
                numbOfComplited = complitedTasks.length;
                numOfActiveTasks = activeTasks.length;
                ReloadNumbOfTasks();
            }
            else{
                document.getElementById(value).style.textDecoration="none";
                if(localStorage.getItem("active") != "")
                {
                    allActive = localStorage.getItem("active").split(',');
                }
                complited_array = localStorage.getItem("complited").split(',');
                for(let i = 0; i < complited_array.length; i++){
                    if(complited_array[i] == value)
                    {
                        allActive.push(complited_array[i]);
                    }
                    else{
                        allComplited.push(complited_array[i]);
                    }
                }

                activeTasks = allActive;
                complitedTasks = allComplited;
                localStorage.setItem('active', allActive);
                localStorage.setItem('complited', allComplited);
                numbOfComplited = complitedTasks.length;
                numOfActiveTasks = activeTasks.length;
                ReloadNumbOfTasks();
            }
            CheckFilter();
        }

        function ReloadNumbOfTasks(){
            var numb = document.getElementById('numbOfActive');
            if(activeTasks[0] != ""){
                numb.innerText = numOfActiveTasks + " items left";
            }else{
                numb.innerText = "0 items left";
            }
        }

        function AllTasks(){
            var btnAll = document.getElementById("all");
            btnAll.classList.add("active");
            var btnComplited = document.getElementById("complited");
            btnComplited.classList.remove("active");
            var btnActive = document.getElementById("active");
            btnActive.classList.remove("active");

            var tasks = document.getElementById("tasks");
            for(let i = 0; i < tasks.children.length; i++)
            {
                var myobj = document.getElementById(tasks.children[i].id);
                i--;
                myobj.remove();
            }

            if(localStorage.getItem("tasks") != ""){
                allTasks = localStorage.getItem("tasks").split(',');
                for(let i = 0; i < allTasks.length; i++)
                {
                    addTask(allTasks[i]);
                }
            }
        }

        function ActiveTasks(){
            var btnAll = document.getElementById("all");
            btnAll.classList.remove("active");
            var btnComplited = document.getElementById("complited");
            btnComplited.classList.remove("active");
            var btnActive = document.getElementById("active");
            btnActive.classList.add("active");

            var tasks = document.getElementById("tasks");
            for(let i = 0; i < tasks.children.length; i++)
            {
                var myobj = document.getElementById(tasks.children[i].id);
                i--;
                myobj.remove();
            }

            if(localStorage.getItem("active") != ""){
                activeTasks = localStorage.getItem("active").split(',');
                for(let i = 0; i < activeTasks.length; i++)
                {
                    addTask(activeTasks[i]);
                }
            }
        }

        function ComplitedTasks(){
            var btnAll = document.getElementById("all");
            btnAll.classList.remove("active");
            var btnComplited = document.getElementById("complited");
            btnComplited.classList.add("active");
            var btnActive = document.getElementById("active");
            btnActive.classList.remove("active");

            var tasks = document.getElementById("tasks");
            for(let i = 0; i < tasks.children.length; i++)
            {
                var myobj = document.getElementById(tasks.children[i].id);
                i--;
                myobj.remove();
            }

            if(localStorage.getItem("complited") != ""){
                complitedTasks = localStorage.getItem("complited").split(',');
                numbOfComplited = complitedTasks.length;
                for(let i = 0; i < complitedTasks.length; i++)
                {
                    addTask(complitedTasks[i]);
                }
            }
        }
    </script>
</body>
</html>